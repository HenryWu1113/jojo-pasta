# 實作計劃

- [x] 1. 資料庫 Schema 更新和設定



  - 更新 user 表格以支援 LINE 登入
  - 建立訂單相關資料表
  - 建立聯絡表單資料表
  - 執行資料庫遷移
  - _需求: 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 2. LINE 登入基礎設施



- [x] 2.1 建立 LINE 登入工具函式


  - 實作虛擬電子郵件生成邏輯
  - 建立 LINE API 呼叫函式
  - 實作用戶查找和建立邏輯
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 2.2 實作 LINE 登入 API 路由


  - 建立 `/api/auth/line` 重導向路由
  - 實作 `/api/auth/line/callback` 回調處理
  - 整合 Better Auth session 管理
  - 新增錯誤處理和重導向邏輯
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 3. 身份驗證 UI 模組



- [x] 3.1 建立身份驗證模組結構


  - 建立 `src/modules/auth/ui/views/auth-view.tsx`
  - 建立 `src/modules/auth/ui/components/` 目錄結構
  - 建立 `src/app/auth/login/page.tsx` 登入頁面
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 3.2 實作 LINE 登入元件


  - 建立 `LineLoginButton` 元件
  - 建立 `UserProfile` 顯示元件
  - 建立 `LogoutButton` 元件
  - 整合 Better Auth 客戶端 hooks
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 4. 購物車系統





- [ ] 4.1 建立購物車 Context 和 Provider
  - 實作 `CartProvider` 和 `CartContext`
  - 建立購物車狀態管理邏輯
  - 實作 localStorage 持久化
  - 建立購物車操作函式 (add, remove, update, clear)


  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5_

- [ ] 4.2 建立購物車 UI 元件
  - 建立 `src/modules/cart/ui/components/cart-summary.tsx`
  - 建立 `src/modules/cart/ui/components/cart-drawer.tsx`
  - 建立 `src/modules/cart/ui/components/cart-item.tsx`
  - 整合到導航列中顯示購物車摘要
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5_

- [ ] 5. 菜單頁面購物車整合
- [ ] 5.1 更新菜單頁面加入購物車功能
  - 在 `FoodCard` 元件中新增「加入購物車」按鈕
  - 整合 `CartContext` 到菜單頁面
  - 實作商品加入購物車的邏輯
  - 新增購物車狀態的視覺回饋
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5_

- [ ] 6. 外帶自取頁面模組
- [ ] 6.1 建立外帶自取頁面結構
  - 建立 `src/modules/takeaway/ui/views/takeaway-view.tsx`
  - 建立 `src/modules/takeaway/ui/components/` 目錄
  - 建立 `src/app/takeaway/page.tsx`
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7_

- [ ] 6.2 實作購物車檢視元件
  - 建立 `CartReview` 元件顯示選購商品
  - 實作商品數量調整功能
  - 實作商品移除功能
  - 顯示小計和總計金額
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7_

- [ ] 6.3 實作顧客資訊表單
  - 建立 `CustomerForm` 元件
  - 整合 React Hook Form 和 Zod 驗證
  - 實作已登入用戶自動填入邏輯
  - 新增表單驗證和錯誤顯示
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7_

- [ ] 6.4 實作取餐時間選擇器
  - 建立 `TimeSlotPicker` 元件
  - 實作營業時間和時間段邏輯
  - 計算最短準備時間
  - 顯示可用和不可用的時間段
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7_

- [ ] 6.5 實作訂單摘要和確認
  - 建立 `OrderSummary` 元件
  - 建立 `OrderConfirmation` 元件
  - 實作訂單提交邏輯
  - 顯示訂單編號和取餐資訊
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7_

- [ ] 7. 訂單 API 和後端邏輯
- [ ] 7.1 建立訂單 API 路由
  - 實作 `POST /api/orders` 建立訂單
  - 實作 `GET /api/orders/[orderNumber]` 查詢訂單
  - 實作 `GET /api/orders/user/[userId]` 用戶訂單歷史
  - 新增訂單編號生成邏輯
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7_

- [ ] 7.2 實作訂單資料庫操作
  - 建立訂單建立函式
  - 建立訂單查詢函式
  - 實作訂單狀態更新邏輯
  - 新增錯誤處理和驗證
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7_

- [ ] 8. 聯絡我們頁面模組
- [ ] 8.1 建立聯絡我們頁面結構
  - 建立 `src/modules/contact/ui/views/contact-view.tsx`
  - 建立 `src/modules/contact/ui/components/` 目錄
  - 建立 `src/app/contact/page.tsx`
  - _需求: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 8.2 實作聯絡表單元件
  - 建立 `ContactForm` 元件
  - 整合 React Hook Form 和 Zod 驗證
  - 實作已登入用戶自動填入邏輯
  - 新增表單提交和成功回饋
  - _需求: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 8.3 實作聯絡資訊和地圖元件
  - 建立 `ContactInfo` 元件
  - 重用現有的 `GoogleMap` 元件
  - 整合餐廳聯絡資訊顯示
  - 新增可點擊的電話和地址連結
  - _需求: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 9. 聯絡表單 API 和後端
- [ ] 9.1 建立聯絡表單 API
  - 實作 `POST /api/contact` 提交聯絡表單
  - 新增表單資料驗證
  - 實作資料庫儲存邏輯
  - 新增成功和錯誤回應處理
  - _需求: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 10. 導航列和使用者體驗更新
- [x] 10.1 更新導航列整合身份驗證



  - 在導航列中新增登入/用戶頭像顯示
  - 整合購物車摘要到導航列
  - 實作響應式的使用者選單
  - 新增登出功能
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 2.1, 2.2, 2.3, 2.4, 2.5_

- [ ] 11. 首頁功能增強
- [ ] 11.1 在首頁新增訂餐 CTA 按鈕
  - 在 `FirstSectionView` 中新增「立即訂餐」按鈕
  - 在 `RecommendationView` 中新增快速加入購物車功能
  - 更新 `FeaturesView` 突出外帶自取服務
  - 確保所有 CTA 正確連結到相關頁面
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5_

- [ ] 12. 表單驗證和錯誤處理
- [ ] 12.1 建立統一的驗證 Schema
  - 建立 `src/lib/validations.ts` 檔案
  - 實作訂單表單驗證 schema
  - 實作聯絡表單驗證 schema
  - 實作電子郵件���定驗證 schema
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 12.2 實作全域錯誤處理
  - 整合 sonner toast 通知系統
  - 建立統一的錯誤處理函式
  - 實作 API 錯誤回應處理
  - 新增載入狀態和使用者回饋
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 13. 使用者體驗增強功能
- [ ] 13.1 實作創意 Back to Top 按鈕
  - 建立 `src/modules/ui/back-to-top.tsx` 元件
  - 實作滾動偵測邏輯（超過 300px 顯示）
  - 設計義大利麵主題的創意動畫效果
  - 實作平滑滾動回到頂部功能
  - _需求: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6_

- [ ] 13.2 整合 Back to Top 到全域佈局
  - 在 `src/app/layout.tsx` 中整合 BackToTop 元件
  - 確保在所有頁面都能正常運作
  - 測試響應式設計和觸控操作
  - 優化動畫效能和使用者體驗
  - _需求: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6_

- [ ] 14. 餐點管理系統
- [ ] 14.1 建立餐點資料庫 Schema
  - 更新 `src/db/schema.ts` 新增 menuItems 和 menuCategories 資料表
  - 建立餐點相關的資料庫工具函式
  - 執行資料庫遷移
  - 建立預設分類資料
  - _需求: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7_

- [ ] 14.2 建立餐點管理 API
  - 實作 `GET /api/admin/menu-items` 取得所有餐點
  - 實作 `POST /api/admin/menu-items` 建立新餐點
  - 實作 `PUT /api/admin/menu-items/[id]` 更新餐點
  - 實作 `DELETE /api/admin/menu-items/[id]` 刪除餐點
  - 實作 `GET /api/menu-items` 公開的餐點 API（供前端菜單使用）
  - _需求: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7_

- [ ] 14.3 建立餐點管理 UI 模組
  - 建立 `src/modules/admin/ui/views/menu-management-view.tsx`
  - 建立餐點列表元件
  - 建立餐點表單元件（新增/編輯）
  - 建立餐點刪除確認對話框
  - _需求: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7_

- [ ] 14.4 實作圖片上傳功能
  - 整合 Cloudinary 或其他圖片服務
  - 建立圖片上傳元件
  - 實作圖片壓縮和優化
  - 新增圖片預覽功能
  - _需求: 7.7_

- [ ] 14.5 更新菜單頁面使用資料庫資料
  - 修改 `src/modules/menu/ui/views/menu-view.tsx` 使用 API 資料
  - 移除硬編碼的假資料
  - 實作載入狀態和錯誤處理
  - 確保分類篩選和搜尋功能正常運作
  - _需求: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7_

- [ ] 14.6 建立管理員權限控制
  - 實作管理員角色檢查
  - 建立受保護的管理員路由
  - 新增管理員登入檢查中介軟體
  - 確保只有管理員能存取餐點管理功能
  - _需求: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7_

- [ ] 15. 測試和優化
- [ ] 14.1 實作基本測試
  - 測試購物車邏輯功能
  - 測試表單驗證邏輯
  - 測試 API 端點回應
  - 測試 LINE 登入流程
  - 測試 Back to Top 功能
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 2.1, 2.2, 2.3, 2.4, 2.5, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 5.1, 5.2, 5.3, 5.4, 5.5, 6.1, 6.2, 6.3, 6.4, 6.5, 6.6_

- [ ] 15.1 實作基本測試
  - 測試購物車邏輯功能
  - 測試表單驗證邏輯
  - 測試 API 端點回應
  - 測試 LINE 登入流程
  - 測試 Back to Top 功能
  - 測試餐點管理功能
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 2.1, 2.2, 2.3, 2.4, 2.5, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 5.1, 5.2, 5.3, 5.4, 5.5, 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7_

- [ ] 15.2 效能優化和最終調整
  - 優化圖片載入和快取
  - 實作購物車狀態持久化
  - 檢查響應式設計在各裝置上的表現
  - 進行無障礙功能測試和調整
  - 最終的使用者體驗測試和調整
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 2.1, 2.2, 2.3, 2.4, 2.5, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 5.1, 5.2, 5.3, 5.4, 5.5, 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7_